<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Danh sách AU | My AUS Wiki</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <header>
    <h1>Danh sách AU</h1>
  </header>

  <nav>
    <ul>
      <li><a href="./index.html">Trang chủ</a></li>
      <li><a href="./aus.html" class="active">Danh sách AU</a></li>
      <li><a href="./create-aus.html">Tạo AU</a></li>
    </ul>
  </nav>

  <main id="main">
    <div id="aus-list"><p>Đang tải AU...</p></div>
  </main>

  <footer>
    <p>&copy; 2025 My AUS Wiki</p>
  </footer>

  <script>
    // IMPORTANT: Replace API_BASE with your backend URL where the /aus endpoint lives.
    const API_BASE = "https://dust-aus-backend.onrender.com"; // <-- REPLACE with your actual backend

    async function loadAUs() {
      const container = document.getElementById('aus-list');
      try {
        const res = await fetch(API_BASE + '/aus');
        if (!res.ok) {
          container.innerHTML = '<p>Không thể lấy dữ liệu từ server.</p>';
          return;
        }
        const data = await res.json();
        if (!Array.isArray(data) || data.length === 0) {
          container.innerHTML = '<p>Chưa có AU nào được gửi.</p>';
          return;
        }
        const listHtml = data.slice().reverse().map(a => `
          <div class="au-card">
            <h2>${escapeHtml(a.name)}</h2>
            <p><strong>Tác giả:</strong> ${escapeHtml(a.author)}</p>
            <p>${escapeHtml(a.desc)}</p>
            <p><strong>Link:</strong> ${a.link && a.link !== 'Không có' ? '<a href="'+escapeAttr(a.link)+'" target="_blank">'+escapeHtml(a.link)+'</a>' : 'Không có'}</p>
            <p class="meta"><small>Gửi: ${new Date(a.created || a.id || Date.now()).toLocaleString('vi-VN')}</small></p>
          </div>
        `).join('');
        container.innerHTML = listHtml;
      } catch (err) {
        console.error(err);
        container.innerHTML = '<p>Lỗi khi kết nối tới backend.</p>';
      }
    }

    function escapeHtml(s) {
      if (!s) return '';
      return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]; });
    }
    function escapeAttr(s){ return escapeHtml(s); }

    loadAUs();
  </script>
</body>
</html>
